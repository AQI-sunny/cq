<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>案件关键信息填空表</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: #e6e6e6;
            line-height: 1.6;
            padding: 10px;
            min-height: 100vh;
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                              url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="%23222" stroke-width="1"/></svg>');
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            background-color: #162447;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border-left: 5px solid #e43f5a;
        }
        
        .header h1 {
            color: #fff;
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .header .dialogue {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #1f4068;
        }
        
        .header .dialogue p {
            margin: 0;
            font-size: 1.1rem;
            color: #f1f1f1;
        }
        
        .question-container {
            background-color: #1f4068;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .question-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #f1f1f1;
            border-bottom: 2px solid #e43f5a;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .question-title .number {
            background-color: #e43f5a;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .answer-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #2d4059;
            border-radius: 8px;
            background-color: #0f3460;
            color: #fff;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #e43f5a;
            box-shadow: 0 0 0 2px rgba(228, 63, 90, 0.3);
        }
        
        .answer-input.highlight {
            border-color: #ff9a3c;
            box-shadow: 0 0 0 2px rgba(255, 154, 60, 0.5);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 2px rgba(255, 154, 60, 0.5); }
            50% { box-shadow: 0 0 0 4px rgba(255, 154, 60, 0.3); }
            100% { box-shadow: 0 0 0 2px rgba(255, 154, 60, 0.5); }
        }
        
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .option {
            background-color: #2d4059;
            color: #e6e6e6;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .option:hover {
            background-color: #3d5a80;
            transform: translateY(-2px);
        }
        
        .option.selected {
            background-color: #e43f5a;
            color: white;
            border-color: #ff6b81;
        }
        
        /* 多选样式 */
        .option.multi-selected {
            background-color: #4ecdc4;
            color: white;
            border-color: #6ae9e0;
        }
        
        .buttons-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 16px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-submit {
            background-color: #e43f5a;
            color: white;
        }
        
        .btn-submit:hover {
            background-color: #ff6b81;
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(228, 63, 90, 0.4);
        }
        
        .btn-reset {
            background-color: #2d4059;
            color: #e6e6e6;
        }
        
        .btn-reset:hover {
            background-color: #3d5a80;
            transform: translateY(-3px);
        }
        
        .progress-container {
            background-color: #162447;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #2d4059;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #e43f5a;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* 自定义弹窗 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            padding: 15px;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: #1f4068;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #fff;
            text-align: center;
            border-bottom: 2px solid #e43f5a;
            padding-bottom: 15px;
        }
        
        .modal-content {
            font-size: 1.1rem;
            margin-bottom: 25px;
            color: #e6e6e6;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn.confirm {
            background-color: #e43f5a;
            color: white;
        }
        
        .modal-btn.confirm:hover {
            background-color: #ff6b81;
        }
        
        .modal-btn.cancel {
            background-color: #2d4059;
            color: #e6e6e6;
        }
        
        .modal-btn.cancel:hover {
            background-color: #3d5a80;
        }
        
        /* 多选题提示 */
        .multi-hint {
            font-size: 0.9rem;
            color: #ff9a3c;
            margin-top: 5px;
            margin-bottom: 10px;
            padding: 5px 10px;
            background-color: rgba(255, 154, 60, 0.1);
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 答案输入区域样式 */
        .answer-display {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 40px;
            padding: 8px;
            background-color: rgba(13, 41, 80, 0.5);
            border-radius: 8px;
        }
        
        .answer-tag {
            background-color: #3d5a80;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .answer-tag .remove {
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 0.8;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .question-title {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 14px 15px;
                font-size: 1rem;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .options-container {
                gap: 8px;
            }
            
            .option {
                padding: 7px 12px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.4rem;
            }
            
            .question-title {
                font-size: 1.1rem;
            }
            
            .answer-input {
                padding: 10px 12px;
                font-size: 0.95rem;
            }
            
            .option {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .answer-tag {
                padding: 4px 10px;
                font-size: 0.85rem;
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question-container {
            animation: fadeIn 0.5s ease forwards;
        }
        
        .question-container:nth-child(odd) {
            animation-delay: 0.1s;
        }
        
        .question-container:nth-child(even) {
            animation-delay: 0.2s;
        }
        
        /* 防止TapTap小程序中的点击高亮 */
        * {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
    <link rel="stylesheet" href="sc-style.css">
    <link rel="icon" type="image/png" href="dtma.png">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-file-contract"></i> 案件关键信息填空表</h1>
            <div class="dialogue">
                <p><i class="fas fa-user"></i> <strong>魏警官：</strong> 你填一下这个表吧。</p>
             <br>
                <p>     温馨提示：找不到该表？搜索"填表"即可！</p>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-text">
                <span>填写进度: <span id="completed-count">0</span>/<span id="total-count">14</span></span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <div id="questions-container">
            <!-- 问题将通过JavaScript动态生成 -->
        </div>
        
        <div class="buttons-container">
            <button class="btn btn-reset" id="reset-btn">
                <i class="fas fa-redo"></i> 重置所有答案
            </button>
            <button class="btn btn-submit" id="submit-btn">
                <i class="fas fa-paper-plane"></i> 提交答案
            </button>
        </div>
    </div>
    
    <!-- 自定义弹窗 - 消息弹窗 -->
    <div class="modal-overlay" id="message-modal">
        <div class="modal">
            <div class="modal-header" id="message-title">提示</div>
            <div class="modal-content" id="message-content">
                <!-- 消息内容将通过JavaScript动态生成 -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="message-ok">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 自定义弹窗 - 确认弹窗 -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal">
            <div class="modal-header" id="confirm-title">确认</div>
            <div class="modal-content" id="confirm-content">
                <!-- 确认内容将通过JavaScript动态生成 -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="confirm-cancel">取消</button>
                <button class="modal-btn confirm" id="confirm-ok">确定</button>
            </div>
        </div>
    </div>
    
    <script>
        // 问题数据 - 根据注释优化
        const questionsData = [
            /* 分割线 - 凶手部分 */
            { 
                id: 1, 
                text: "你认为真凶是：__________", 
                correctAnswer: "叶兰", 
                options: ["沈笑静", "李健兴", "麦姝冰", "何安", "张威", "周于彰", "文心竹", "严真真", "叶兰", "Rein", "卫明澈"],
                type: "single", // 单选题
                hint: "" 
            },
            { 
                id: 2, 
                text: "你认为帮凶是：__________", 
                correctAnswer: ["卫明澈", "周于彰", "何安", "文心竹"], // 选择其一就对
                options: ["沈笑静", "李健兴", "麦姝冰", "何安", "张威", "周于彰", "文心竹", "严真真", "叶兰", "Rein", "卫明澈"],
                type: "multi-one", // 多选，选择其中任意一个即正确
                hint: "提示：选择其中一个正确答案即可" 
            },
            { 
                id: 3, 
                text: "你认为主犯是：__________（ps：整个犯罪的组织者、策划者，在共同犯罪中起主要作用，是主犯。）", 
                correctAnswer: "张威", 
                options: ["沈笑静", "李健兴", "麦姝冰", "何安", "张威", "周于彰", "文心竹", "严真真", "叶兰", "Rein", "卫明澈"],
                type: "single",
                hint: "" 
            },
            
            /* 分割线 - 动机部分 */
            { 
                id: 4, 
                text: "你认为真凶的动机是：__________", 
                correctAnswer: "父亲被害", 
                options: ["父亲被害", "母亲被害", "公司被抢", "兄弟姐妹被害", "好友被害", "挪用公款被发现", "看李老板不爽", "帮好友忙", "帮喜欢的人的忙"],
                type: "single",
                hint: "" 
            },
            { 
                id: 5, 
                text: "你认为主犯的动机是：__________", 
                correctAnswer: ["父亲被害", "母亲被害", "公司被抢"], // 三个都选才对
                options: ["父亲被害", "母亲被害", "公司被抢", "兄弟姐妹被害", "好友被害", "挪用公款被发现", "看李老板不爽", "帮好友忙", "帮喜欢的人的忙"],
                type: "multi-all", // 多选，需要选择所有正确答案
                hint: "提示：需要选择所有正确答案" 
            },
            { 
                id: 6, 
                text: "你认为其他帮凶的动机是：__________", 
                correctAnswer: "母亲被害", 
                options: ["父亲被害", "母亲被害", "公司被抢", "兄弟姐妹被害", "好友被害", "挪用公款被发现", "看李老板不爽", "帮好友忙", "帮喜欢的人的忙"],
                type: "single",
                hint: "" 
            },
            
            /* 分割线 - 死因部分 */
            { 
                id: 7, 
                text: "你认为死者是：__________", 
                correctAnswer: "他杀", 
                options: ["自杀", "他杀"],
                type: "single",
                hint: "" 
            },
            { 
                id: 8, 
                text: "你认为死者死因是：__________", 
                correctAnswer: ["突发性心脏骤停", "心源性猝死"], // 选哪个都对，可多选，选择两个也对
                options: ["恶性心律失常", "突发性心脏骤停", "慢性心脏病", "严重低血钾", "心源性猝死", "洋地黄毒苷中毒"],
                type: "multi-any", // 多选，选择其中任意正确答案
                hint: "提示：选择其中任意正确答案" 
            },
            { 
                id: 9, 
                text: "你认为死者死亡时间为：__________", 
                correctAnswer: ["19:50左右", "22:00前"], // 两个之一就对
                options: ["19:50左右", "22:00前", "22:00后"],
                type: "multi-one", // 多选，选择其中一个即正确
                hint: "提示：选择其中一个正确答案即可" 
            },
            
            /* 分割线 - 毒药部分 */
            { 
                id: 10, 
                text: "你认为毒药是：__________", 
                correctAnswer: "洋地黄毒苷", 
                options: ["西柚/葡萄柚", "蜂蜜柚子茶", "洋地黄毒苷", "氢氯噻嗪", "呋喃香豆素"],
                type: "single",
                hint: "" 
            },
            { 
                id: 11, 
                text: "你认为的毒药增强物是：__________", 
                correctAnswer: ["氢氯噻嗪", "西柚/葡萄柚", "蜂蜜柚子茶"], // 必选氢氯噻嗪，其他两个选其中一个就对
                options: ["西柚/葡萄柚", "蜂蜜柚子茶", "洋地黄毒苷", "氢氯噻嗪", "呋喃香豆素"],
                type: "multi-complex", // 复杂多选，需要包含必选项
                hint: "提示：多选题" 
            },
            { 
                id: 12, 
                text: "你认为的下毒者有：__________", 
                correctAnswer: ["卫明澈", "叶兰"], // 多选，选择两个才对
                options: ["沈笑静", "李健兴", "麦姝冰", "何安", "张威", "周于彰", "文心竹", "严真真", "叶兰", "Rein", "卫明澈"],
                type: "multi-all", // 多选，需要选择所有正确答案
                hint: "提示：需要选择所有正确答案" 
            },
            { 
                id: 13, 
                text: "你认为的下毒方式是：__________", 
                correctAnswer: ["蜂蜜柚子茶","送文件"], // 多选，选择两个才对
                options: ["蜂蜜柚子茶", "送文件", "注射剂", "勾引/使用口红"],
                type: "multi-all", // 多选，需要选择所有正确答案
                hint: "提示：需要选择所有正确答案" 
            },
            
            /* 分割线 - 案件细节部分 */
            { 
                id: 14, 
                text: "你认为BOSS晚上七点多消失后会在____________？", 
                correctAnswer: "物业管理处5楼储物间", 
                options: ["物业管理处5楼储物间", "电梯厢顶", "电梯井里", "董事长办公室"],
                type: "single",
                hint: "" 
            },
            { 
                id: 15, 
                text: "你认为BOSS目前在____________？", 
                correctAnswer: "电梯厢顶", 
                options: ["物业管理处5楼储物间", "电梯厢顶", "电梯井里", "董事长办公室"],
                type: "single",
                hint: "" 
            },
            { 
                id: 16, 
                text: "你认为监控被____________动了手脚？", 
                correctAnswer: ["何安","周于彰"], // 多选，选择两个才对
                options: ["沈笑静", "李健兴", "麦姝冰", "何安", "张威", "周于彰", "文心竹", "严真真", "叶兰", "Rein", "卫明澈"],
                type: "multi-all", // 多选，需要选择所有正确答案
                hint: "提示：需要选择所有正确答案" 
            },
            { 
                id: 17, 
                text: "你认为电梯停运原因是__________？", 
                correctAnswer: ["火警装置", "周于彰"], // 两个之一就对
                options: ["火警装置", "周于彰", "电梯故障", "何安", "卫明澈", "叶兰"],
                type: "multi-one", // 多选，选择其中一个即正确
                hint: "提示：选择其中一个正确答案即可" 
            },
            { 
                id: 18, 
                text: "你认为是谁挪用了公款__________", 
                correctAnswer: ["卫明澈", "严真真", "李健兴"], // 其中之一就对
                options: ["沈笑静", "李健兴", "麦姝冰", "何安", "张威", "周于彰", "文心竹", "严真真", "叶兰", "Rein", "卫明澈"],
                type: "multi-one", // 多选，选择其中一个即正确
                hint: "提示：选择其中一个正确答案即可" 
            },
            { 
                id: 19, 
                text: "请提交涉嫌挪用公款的境外账户__________", 
                correctAnswer: "PTB-ZH-718X-ALPHA9",
                type: "text", // 文本输入
                hint: "提示：直接输入正确答案" 
            },
            { 
                id: 20, 
                text: "请提交原始视频监控数据密钥__________", 
                correctAnswer: "65aB3$kL9@mZx!pRqW",
                type: "text", // 文本输入
                hint: "提示：直接输入正确答案" 
            }
        ];
        
        // 用户答案存储
        let userAnswers = {};
        
        // 初始化函数
        function init() {
            // 初始化用户答案对象，对于多选题初始化为数组
            questionsData.forEach(q => {
                if (q.type.includes("multi") || q.type.includes("complex")) {
                    userAnswers[q.id] = [];
                } else {
                    userAnswers[q.id] = '';
                }
            });
            
            renderQuestions();
            updateProgress();
            
            // 事件监听
            document.getElementById('submit-btn').addEventListener('click', submitAnswers);
            document.getElementById('reset-btn').addEventListener('click', resetAllAnswers);
            document.getElementById('message-ok').addEventListener('click', closeMessageModal);
            document.getElementById('confirm-cancel').addEventListener('click', closeConfirmModal);
            document.getElementById('confirm-ok').addEventListener('click', handleConfirmOk);
        }
        
        // 渲染问题
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            // 更新总数显示
            document.getElementById('total-count').textContent = questionsData.length;
            
            questionsData.forEach(question => {
                const questionEl = document.createElement('div');
                questionEl.className = 'question-container';
                questionEl.id = `question-${question.id}`;
                
                let answerArea = '';
                if (question.type.includes("multi") || question.type.includes("complex")) {
                    // 多选题：显示已选择的标签
                    answerArea = `
                        <div class="answer-display" id="answer-display-${question.id}">
                            ${renderAnswerTags(question.id)}
                        </div>
                    `;
                } else {
                    // 单选题或文本题：显示输入框
                    const value = Array.isArray(userAnswers[question.id]) 
                        ? userAnswers[question.id].join(', ') 
                        : userAnswers[question.id];
                    
                    answerArea = `
                        <input 
                            type="text" 
                            class="answer-input"
                            id="answer-${question.id}"
                            placeholder="点击输入答案或从下方选择"
                            data-id="${question.id}"
                            value="${value || ''}"
                        >
                    `;
                }
                
                questionEl.innerHTML = `
                    <div class="question-title">
                        <span class="number">${question.id}</span>
                        <span>${question.text}</span>
                    </div>
                    ${question.hint ? `<div class="multi-hint"><i class="fas fa-info-circle"></i> ${question.hint}</div>` : ''}
                    ${answerArea}
                    ${question.type !== 'text' ? `
                        <div class="options-container" id="options-${question.id}">
                            ${renderOptions(question.options, question.id, question.type)}
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(questionEl);
                
                // 为输入框添加事件（单选题）
                if (!question.type.includes("multi") && !question.type.includes("complex") && question.type !== 'text') {
                    const input = document.getElementById(`answer-${question.id}`);
                    input.addEventListener('input', function() {
                        const id = parseInt(this.dataset.id);
                        userAnswers[id] = this.value.trim();
                        updateProgress();
                        updateOptionSelection(id);
                    });
                }
                
                // 为文本输入框添加事件
                if (question.type === 'text') {
                    const input = document.getElementById(`answer-${question.id}`);
                    input.addEventListener('input', function() {
                        const id = parseInt(this.dataset.id);
                        userAnswers[id] = this.value.trim();
                        updateProgress();
                    });
                }
                
                // 为选项添加点击事件
                if (question.type !== 'text') {
                    const optionsContainer = document.getElementById(`options-${question.id}`);
                    optionsContainer.addEventListener('click', function(e) {
                        if (e.target.classList.contains('option')) {
                            const id = parseInt(this.id.split('-')[1]);
                            const value = e.target.textContent;
                            const questionType = questionsData.find(q => q.id === id).type;
                            
                            handleOptionClick(id, value, questionType, e.target);
                        }
                    });
                }
            });
        }
        
        // 渲染答案标签（多选题）
        function renderAnswerTags(questionId) {
            const answers = userAnswers[questionId];
            if (!Array.isArray(answers) || answers.length === 0) {
                return '<span style="color: #888; font-style: italic;">暂无选择</span>';
            }
            
            return answers.map(answer => `
                <div class="answer-tag">
                    ${answer}
                    <span class="remove" data-id="${questionId}" data-value="${answer}">×</span>
                </div>
            `).join('');
        }
        
        // 处理选项点击
        function handleOptionClick(questionId, value, questionType, targetElement) {
            const question = questionsData.find(q => q.id === questionId);
            
            if (questionType.includes("multi") || questionType.includes("complex")) {
                // 多选题逻辑
                if (!Array.isArray(userAnswers[questionId])) {
                    userAnswers[questionId] = [];
                }
                
                const index = userAnswers[questionId].indexOf(value);
                
                if (index === -1) {
                    // 添加选项
                    userAnswers[questionId].push(value);
                    targetElement.classList.add('multi-selected');
                } else {
                    // 移除选项
                    userAnswers[questionId].splice(index, 1);
                    targetElement.classList.remove('multi-selected');
                }
                
                // 更新答案显示区域
                updateAnswerDisplay(questionId);
            } else {
                // 单选题逻辑
                userAnswers[questionId] = value;
                
                // 更新输入框
                const input = document.getElementById(`answer-${questionId}`);
                if (input) {
                    input.value = value;
                }
                
                // 更新选项样式
                const allOptions = document.querySelectorAll(`#options-${questionId} .option`);
                allOptions.forEach(opt => {
                    if (opt.textContent === value) {
                        opt.classList.add('selected');
                    } else {
                        opt.classList.remove('selected');
                    }
                });
            }
            
            updateProgress();
        }
        
        // 更新答案显示区域（多选题）
        function updateAnswerDisplay(questionId) {
            const displayEl = document.getElementById(`answer-display-${questionId}`);
            if (displayEl) {
                displayEl.innerHTML = renderAnswerTags(questionId);
                
                // 为移除按钮添加事件
                displayEl.querySelectorAll('.remove').forEach(removeBtn => {
                    removeBtn.addEventListener('click', function() {
                        const qId = parseInt(this.dataset.id);
                        const value = this.dataset.value;
                        
                        // 从答案数组中移除
                        const index = userAnswers[qId].indexOf(value);
                        if (index !== -1) {
                            userAnswers[qId].splice(index, 1);
                        }
                        
                        // 更新选项样式
                        const optionEl = document.querySelector(`#options-${qId} .option[data-value="${value}"]`);
                        if (optionEl) {
                            optionEl.classList.remove('multi-selected');
                        }
                        
                        // 更新显示
                        updateAnswerDisplay(qId);
                        updateProgress();
                    });
                });
            }
        }
        
        // 渲染选项
        function renderOptions(options, questionId, questionType) {
            const currentAnswer = userAnswers[questionId];
            
            return options.map(option => {
                let selectedClass = '';
                
                if (questionType.includes("multi") || questionType.includes("complex")) {
                    // 多选题：检查是否在数组中
                    if (Array.isArray(currentAnswer) && currentAnswer.includes(option)) {
                        selectedClass = 'multi-selected';
                    }
                } else {
                    // 单选题：检查是否相等
                    if (currentAnswer === option) {
                        selectedClass = 'selected';
                    }
                }
                
                return `<div class="option ${selectedClass}" data-value="${option}">${option}</div>`;
            }).join('');
        }
        
        // 更新选项选择状态
        function updateOptionSelection(questionId) {
            const question = questionsData.find(q => q.id === questionId);
            if (!question) return;
            
            const optionsContainer = document.getElementById(`options-${questionId}`);
            const currentAnswer = userAnswers[questionId];
            
            if (optionsContainer && currentAnswer) {
                const allOptions = optionsContainer.querySelectorAll('.option');
                allOptions.forEach(opt => {
                    if (question.type.includes("multi") || question.type.includes("complex")) {
                        // 多选题
                        if (Array.isArray(currentAnswer) && currentAnswer.includes(opt.textContent)) {
                            opt.classList.add('multi-selected');
                        } else {
                            opt.classList.remove('multi-selected');
                        }
                    } else {
                        // 单选题
                        if (opt.textContent === currentAnswer) {
                            opt.classList.add('selected');
                        } else {
                            opt.classList.remove('selected');
                        }
                    }
                });
            }
        }
        
        // 检查答案是否正确
        function checkAnswer(questionId) {
            const question = questionsData.find(q => q.id === questionId);
            const userAnswer = userAnswers[questionId];
            
            if (!question || (!userAnswer && userAnswer !== '' && (!Array.isArray(userAnswer) || userAnswer.length === 0))) {
                return false; // 未作答
            }
            
            switch (question.type) {
                case 'single':
                case 'text':
                    // 单选题或文本题：直接比较
                    return userAnswer === question.correctAnswer;
                    
                case 'multi-one':
                    // 多选一：用户答案包含任意一个正确答案即可
                    if (Array.isArray(userAnswer) && Array.isArray(question.correctAnswer)) {
                        return question.correctAnswer.some(correct => userAnswer.includes(correct));
                    }
                    return false;
                    
                case 'multi-any':
                    // 多选任意：用户答案包含任意正确答案即可，不要求全部
                    if (Array.isArray(userAnswer) && Array.isArray(question.correctAnswer)) {
                        return userAnswer.some(answer => question.correctAnswer.includes(answer));
                    }
                    return false;
                    
                case 'multi-all':
                    // 多选全部：用户答案必须包含所有正确答案
                    if (Array.isArray(userAnswer) && Array.isArray(question.correctAnswer)) {
                        return question.correctAnswer.every(correct => userAnswer.includes(correct)) && 
                               userAnswer.every(answer => question.correctAnswer.includes(answer));
                    }
                    return false;
                    
                case 'multi-complex':
                    // 复杂多选：必须包含必选项，且至少包含一个其他正确选项
                    if (Array.isArray(userAnswer) && Array.isArray(question.correctAnswer)) {
                        // 氢氯噻嗪是必选项
                        const required = "氢氯噻嗪";
                        if (!userAnswer.includes(required)) {
                            return false;
                        }
                        
                        // 检查是否包含至少一个其他正确选项
                        const otherCorrect = question.correctAnswer.filter(item => item !== required);
                        return userAnswer.some(answer => otherCorrect.includes(answer));
                    }
                    return false;
                    
                default:
                    return false;
            }
        }
        
        // 计算正确答案数量
        function calculateCorrectAnswers() {
            let correctCount = 0;
            
            questionsData.forEach(question => {
                if (checkAnswer(question.id)) {
                    correctCount++;
                }
            });
            
            return correctCount;
        }
        
        // 更新进度
        function updateProgress() {
            const total = questionsData.length;
            let completed = 0;
            
            questionsData.forEach(question => {
                const answer = userAnswers[question.id];
                if (question.type.includes("multi") || question.type.includes("complex")) {
                    // 多选题：只要选择了至少一个选项就算完成
                    if (Array.isArray(answer) && answer.length > 0) {
                        completed++;
                    }
                } else {
                    // 单选题或文本题：有内容就算完成
                    if (answer && answer.trim() !== '') {
                        completed++;
                    }
                }
            });
            
            const completedCountEl = document.getElementById('completed-count');
            const progressFillEl = document.getElementById('progress-fill');
            
            completedCountEl.textContent = completed;
            
            // 计算进度百分比
            const progressPercent = (completed / total) * 100;
            progressFillEl.style.width = `${progressPercent}%`;
        }
        
        // 获取第一个未填写的问题ID
        function getFirstUnansweredQuestionId() {
            for (let i = 0; i < questionsData.length; i++) {
                const question = questionsData[i];
                const answer = userAnswers[question.id];
                
                let isAnswered = false;
                if (question.type.includes("multi") || question.type.includes("complex")) {
                    isAnswered = Array.isArray(answer) && answer.length > 0;
                } else {
                    isAnswered = answer && answer.trim() !== '';
                }
                
                if (!isAnswered) {
                    return question.id;
                }
            }
            return null;
        }
        
        // 滚动到指定问题并高亮
        function scrollToQuestion(questionId) {
            const questionElement = document.getElementById(`question-${questionId}`);
            let inputElement = document.getElementById(`answer-${questionId}`);
            
            // 对于多选题，没有输入框，直接滚动到问题
            if (!inputElement) {
                inputElement = document.getElementById(`answer-display-${questionId}`);
            }
            
            if (questionElement) {
                // 移除之前的高亮
                document.querySelectorAll('.answer-input.highlight').forEach(input => {
                    input.classList.remove('highlight');
                });
                
                // 滚动到问题位置
                questionElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                
                // 添加高亮效果
                if (inputElement) {
                    setTimeout(() => {
                        inputElement.classList.add('highlight');
                        if (inputElement.tagName === 'INPUT') {
                            inputElement.focus();
                        }
                    }, 300);
                }
            }
        }
        
        // 提交答案
        function submitAnswers() {
            // 检查是否所有问题都已填写
            const total = questionsData.length;
            let completed = 0;
            
            questionsData.forEach(question => {
                const answer = userAnswers[question.id];
                if (question.type.includes("multi") || question.type.includes("complex")) {
                    if (Array.isArray(answer) && answer.length > 0) {
                        completed++;
                    }
                } else {
                    if (answer && answer.trim() !== '') {
                        completed++;
                    }
                }
            });
            
            if (completed < total) {
                // 找到第一个未填写的问题
                const firstUnansweredId = getFirstUnansweredQuestionId();
                if (firstUnansweredId) {
                    // 滚动到第一个未填写的问题
                    scrollToQuestion(firstUnansweredId);
                    
                    // 显示提示信息
                    showMessage('提示', `您还有${total - completed}个问题未填写，请先填写完整再提交。已自动定位到第一个未填写的问题。`);
                }
                return;
            }
            
            // 计算结果
            const correctCount = calculateCorrectAnswers();
            const wrongCount = total - correctCount;
            
            // 显示简要结果，然后自动跳转
            const resultText = getResultText(correctCount, wrongCount);
            const jumpInfo = getJumpInfo(correctCount, wrongCount);
            
            showMessage('提交结果', `
                <p>您已回答了所有${total}个问题。</p>
                <p><strong>正确：${correctCount} 题</strong></p>
                <p><strong>错误：${wrongCount} 题</strong></p>
                <p>${resultText}</p>
                <p>${jumpInfo}</p>
            `);
            
            // 2秒后自动跳转
            setTimeout(() => {
                jumpToResult(correctCount, wrongCount);
            }, 2000);
        }
        
        // 获取结果文本
        function getResultText(correctCount, wrongCount) {
            if (wrongCount === 0) {
                return '<span style="color: #4ecdc4;">恭喜！所有答案都正确！</span>';
            } else if (wrongCount <= 5) {
                return '<span style="color: #ff9a3c;">有部分错误。</span>';
            } else {
                return '<span style="color: #ff6b6b;">错误较多。</span>';
            }
        }
        
        // 获取跳转信息
        function getJumpInfo(correctCount, wrongCount) {
            if (wrongCount === 0) {
                return '即将跳转到结局页面...';
            } else if (wrongCount <= 5) {
                return '即将跳转到结局B...';
            } else {
                return '即将跳转到结局C...';
            }
        }
        
        // 跳转到结果页面
        function jumpToResult(correctCount, wrongCount) {
            // 根据错误数量跳转到不同页面
            if (wrongCount === 0) {
                window.location.href = 'jieju1.html';
            } else if (wrongCount <= 5) {
                window.location.href = 'jieju2222.html';
                } else if (wrongCount <= 10) {
                window.location.href = 'jieju333.html';
            } else {
                window.location.href = 'jieju4.html';
            }
        }
        
        // 重置所有答案
        function resetAllAnswers() {
            showConfirm('确认重置', '您确定要重置所有答案吗？这将会清空所有已填写的内容。')
                .then(result => {
                    if (result) {
                        questionsData.forEach(q => {
                            if (q.type.includes("multi") || q.type.includes("complex")) {
                                userAnswers[q.id] = [];
                            } else {
                                userAnswers[q.id] = '';
                            }
                        });
                        renderQuestions();
                        updateProgress();
                        showMessage('重置成功', '所有答案已重置，请重新填写。');
                    }
                });
        }
        
        // 显示消息弹窗
        function showMessage(title, content) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-content').innerHTML = content;
            document.getElementById('message-modal').classList.add('active');
        }
        
        // 关闭消息弹窗
        function closeMessageModal() {
            document.getElementById('message-modal').classList.remove('active');
        }
        
        // 显示确认弹窗
        function showConfirm(title, content) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-content').innerHTML = `<p>${content}</p>`;
            document.getElementById('confirm-modal').classList.add('active');
            
            // 创建Promise来处理确认结果
            return new Promise((resolve) => {
                // 存储resolve函数以便在按钮点击时调用
                window.confirmResolve = resolve;
            });
        }
        
        // 关闭确认弹窗
        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('active');
            if (window.confirmResolve) {
                window.confirmResolve(false);
                window.confirmResolve = null;
            }
        }
        
        // 处理确认弹窗的确定按钮
        function handleConfirmOk() {
            document.getElementById('confirm-modal').classList.remove('active');
            if (window.confirmResolve) {
                window.confirmResolve(true);
                window.confirmResolve = null;
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
