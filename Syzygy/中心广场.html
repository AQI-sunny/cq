<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中心广场老照片</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            height: 70vh;
            min-height: 500px;
            border: 3px solid #4a90e2;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(74, 144, 226, 0.3);
            background: #000;
            touch-action: manipulation;
        }
        
        .game-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .magnifying-glass {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            z-index: 10;
            display: none;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .magnifying-glass::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 45%, rgba(0,0,0,0.8) 100%);
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .magnifying-glass-content {
            position: absolute;
            width: 240px;
            height: 240px;
            background-size: 1000px 1000px;
            border-radius: 50%;
            transform: scale(3); /* 240/80 = 3 */
        }
        
        .fragment {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 50%;
            cursor: pointer;
            z-index: 5;
            transition: all 0.3s ease;
            display: block; /* 默认显示但透明度低 */
            opacity: 0.3;
            animation: pulse 2s infinite;
        }
        
        .fragment.nearby {
            opacity: 0.8;
            background: rgba(255, 215, 0, 0.6);
            border-color: gold;
            transform: scale(1.3);
        }
        
        .fragment.found {
            opacity: 0;
            display: none;
        }
        
        .fragment:hover {
            transform: scale(1.5);
            background: rgba(255, 215, 0, 0.8);
            border-color: gold;
            box-shadow: 0 0 15px gold;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .fragment-detail {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            width: 400px;
            border: 2px solid gold;
            transition: transform 0.3s ease;
        }
        
        .fragment-detail.show {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .fragment-detail h3 {
            color: gold;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .fragment-detail p {
            color: white;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        
        .close-btn:hover {
            background: #c0392b;
        }
        
        .instructions {
            margin-bottom: 10px;
            text-align: center;
            font-size: 16px;
            color: #4a90e2;
            text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
            max-width: 100%;
            padding: 0 10px;
        }
        
        .found-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #4a90e2;
            z-index: 100;
            font-size: 14px;
        }
        
        .controls {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .controls input {
            padding: 8px 12px;
            border: 1px solid #4a90e2;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            width: 250px;
            max-width: 100%;
        }
        
        .controls button {
            padding: 8px 15px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #357abd;
        }
        
        .found-fragments {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #4a90e2;
            z-index: 100;
            max-width: 300px;
            font-size: 12px;
        }
        
        .found-fragments ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .found-fragments li {
            margin: 5px 0;
            color: gold;
            position: relative;
            word-break: break-all;
        }
        
        .remove-found {
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            background: #e74c3c;
            color: white;
            border: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 平板响应式设计 */
        @media (max-width: 1024px) {
            .game-container {
                height: 65vh;
                min-height: 450px;
            }
            
            .magnifying-glass {
                width: 70px;
                height: 70px;
            }
            
            .magnifying-glass-content {
                width: 210px;
                height: 210px;
                transform: scale(3); /* 210/70 = 3 */
            }
            
            .fragment {
                width: 28px;
                height: 28px;
            }
            
            .found-fragments {
                max-width: 250px;
                font-size: 11px;
            }
            
            .found-counter {
                font-size: 13px;
            }
            
            .instructions {
                font-size: 15px;
            }
            
            .controls input {
                width: 220px;
            }
        }
        
        /* 平板小尺寸响应式设计 */
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            
            .game-container {
                height: 60vh;
                min-height: 400px;
                border-width: 2px;
            }
            
            .magnifying-glass {
                width: 60px;
                height: 60px;
            }
            
            .magnifying-glass-content {
                width: 180px;
                height: 180px;
                transform: scale(3); /* 180/60 = 3 */
            }
            
            .fragment {
                width: 25px;
                height: 25px;
            }
            
            .found-fragments {
                max-width: 200px;
                font-size: 10px;
                bottom: 5px;
                left: 5px;
            }
            
            .found-counter {
                top: 5px;
                right: 5px;
                font-size: 12px;
                padding: 5px 8px;
            }
            
            .instructions {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .controls input {
                width: 200px;
            }
            
            .fragment-detail {
                padding: 25px;
                width: 85%;
            }
            
            .fragment-detail h3 {
                font-size: 22px;
            }
            
            .fragment-detail p {
                font-size: 17px;
            }
        }
        
        /* 手机响应式设计 */
        @media (max-width: 480px) {
            body {
                padding: 5px;
                justify-content: flex-start;
            }
            
            .game-container {
                height: 50vh;
                min-height: 300px;
                border-width: 1px;
            }
            
            .magnifying-glass {
                width: 50px;
                height: 50px;
            }
            
            .magnifying-glass-content {
                width: 150px;
                height: 150px;
                transform: scale(3); /* 150/50 = 3 */
            }
            
            .fragment {
                width: 22px;
                height: 22px;
            }
            
            .fragment-detail {
                width: 90%;
                padding: 20px;
            }
            
            .fragment-detail h3 {
                font-size: 20px;
            }
            
            .fragment-detail p {
                font-size: 16px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
                width: 100%;
                margin-top: 8px;
            }
            
            .controls input, .controls button {
                width: 100%;
            }
            
            .found-fragments {
                max-width: 150px;
                font-size: 9px;
                bottom: 3px;
                left: 3px;
                padding: 5px;
            }
            
            .found-counter {
                top: 3px;
                right: 3px;
                font-size: 11px;
                padding: 4px 6px;
            }
            
            .instructions {
                font-size: 13px;
                margin-bottom: 5px;
            }
        }
        
        /* 小屏手机响应式设计 */
        @media (max-width: 360px) {
            .game-container {
                height: 45vh;
                min-height: 250px;
            }
            
            .magnifying-glass {
                width: 40px;
                height: 40px;
            }
            
            .magnifying-glass-content {
                width: 120px;
                height: 120px;
                transform: scale(3); /* 120/40 = 3 */
            }
            
            .fragment {
                width: 18px;
                height: 18px;
            }
            
            .found-fragments {
                max-width: 130px;
                font-size: 8px;
            }
            
            .found-counter {
                font-size: 10px;
                padding: 3px 5px;
            }
            
            .instructions {
                font-size: 12px;
            }
            
            .fragment-detail {
                padding: 15px;
            }
            
            .fragment-detail h3 {
                font-size: 18px;
            }
            
            .fragment-detail p {
                font-size: 14px;
            }
        }
        
        /* 横屏模式优化 */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 5px;
            }
            
            .game-container {
                height: 85vh;
                min-height: 200px;
            }
            
            .instructions {
                margin-bottom: 5px;
                font-size: 12px;
            }
            
            .found-fragments {
                max-width: 200px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="instructions">
        移动鼠标在图片上放大查看细节，靠近发光碎片并点击找到线索！
    </div>
    
    <div class="game-container" id="gameContainer">
        <div class="game-background" id="gameBackground"></div>
        <div class="magnifying-glass" id="magnifyingGlass">
            <div class="magnifying-glass-content" id="magnifyingGlassContent"></div>
        </div>
        <div class="found-counter">已找到: <span id="foundCount">0</span>/5</div>
        <div class="found-fragments">
            <strong>已发现线索:</strong>
            <ul id="foundList"></ul>
        </div>
    </div>
    
    <!-- <div class="controls">
        <input type="text" id="imageInput" placeholder="输入背景图片URL...">
        <button onclick="changeBackground()">更换背景</button>
    </div> -->
    
    <div class="fragment-detail" id="fragmentDetail">
        <h3 id="detailTitle">线索详情</h3>
        <p id="detailText">线索内容</p>
        <button class="close-btn" id="closeDetailBtn">关闭</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gameContainer = document.getElementById('gameContainer');
            const gameBackground = document.getElementById('gameBackground');
            const magnifyingGlass = document.getElementById('magnifyingGlass');
            const magnifyingGlassContent = document.getElementById('magnifyingGlassContent');
            const foundCountElement = document.getElementById('foundCount');
            const foundListElement = document.getElementById('foundList');
            const fragmentDetail = document.getElementById('fragmentDetail');
            const detailTitle = document.getElementById('detailTitle');
            const detailText = document.getElementById('detailText');
            const imageInput = document.getElementById('imageInput');
            const closeDetailBtn = document.getElementById('closeDetailBtn');
            
            // 默认背景图片
            let backgroundImage = 'https://almostwinterao-eng.github.io/my-gallery/1/zxgc.png';
            gameBackground.style.backgroundImage = `url('${backgroundImage}')`;
            
            // 碎片数据 - 调整位置使其更容易找到
            const fragments = [
                { x: 200, y: 150, title: "神秘字母", text: "地板砖上似乎写着一个模糊的“K”" },
                { x: 600, y: 250, title: "神秘图像", text: "中心的雕塑上似乎有一个奇怪的图像，看起来像很多虫子团在一块。" },
                { x: 90, y: 390, title: "神秘符号", text: "水池边缘似乎有一个长得像闪电的符号" },
                /* { x: 100, y: 350, title: "时间线索", text: "19:45，这个时间点很重要" },
                { x: 700, y: 150, title: "人物线索", text: "画像中的人穿着18世纪的服装，身份成谜" } */
            ];
            
            let foundFragments = [];
            let currentBackground = backgroundImage;
            
            // 创建碎片元素
            const fragmentElements = [];
            fragments.forEach(function(fragment, index) {
                const fragmentElement = document.createElement('div');
                fragmentElement.className = 'fragment';
                fragmentElement.style.left = `${fragment.x}px`;
                fragmentElement.style.top = `${fragment.y}px`;
                fragmentElement.dataset.index = index;
                
                fragmentElement.addEventListener('click', function() {
                    showFragmentDetail(fragment);
                    markFragmentFound(index);
                });
                
                // 为触摸设备添加触摸事件
                fragmentElement.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    showFragmentDetail(fragment);
                    markFragmentFound(index);
                });
                
                gameContainer.appendChild(fragmentElement);
                fragmentElements.push(fragmentElement);
            });
            
            // 显示碎片详情
            function showFragmentDetail(fragment) {
                detailTitle.textContent = fragment.title;
                detailText.textContent = fragment.text;
                fragmentDetail.classList.add('show');
            }
            
            // 关闭碎片详情
            function closeFragmentDetail() {
                fragmentDetail.classList.remove('show');
            }
            
            // 为关闭按钮添加事件监听器
            closeDetailBtn.addEventListener('click', closeFragmentDetail);
            
            // 点击详情框外部也可以关闭
            fragmentDetail.addEventListener('click', function(e) {
                if (e.target === fragmentDetail) {
                    closeFragmentDetail();
                }
            });
            
            // 标记碎片已找到
            function markFragmentFound(index) {
                if (!foundFragments.includes(index)) {
                    foundFragments.push(index);
                    foundCountElement.textContent = foundFragments.length;
                    
                    // 添加到已发现列表
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `${fragments[index].title} <button class="remove-found" onclick="removeFoundFragment(${index})">×</button>`;
                    foundListElement.appendChild(listItem);
                    
                    // 隐藏已找到的碎片
                    const fragmentElement = fragmentElements[index];
                    if (fragmentElement) {
                        fragmentElement.classList.add('found');
                    }
                    
                    // 检查是否全部找到
                    if (foundFragments.length === fragments.length) {
                        setTimeout(function() {
                            alert('你已经找到了所有线索，请关闭此页面');
                        }, 500);
                    }
                }
            }
            
            // 移除已发现的线索
            window.removeFoundFragment = function(index) {
                const fragmentIndex = foundFragments.indexOf(index);
                if (fragmentIndex !== -1) {
                    foundFragments.splice(fragmentIndex, 1);
                    foundCountElement.textContent = foundFragments.length;
                    
                    // 重新显示碎片
                    const fragmentElement = fragmentElements[index];
                    if (fragmentElement) {
                        fragmentElement.classList.remove('found');
                    }
                    
                    // 从列表中移除
                    const listItems = foundListElement.querySelectorAll('li');
                    for (let i = 0; i < listItems.length; i++) {
                        if (listItems[i].innerHTML.includes(`onclick="removeFoundFragment(${index})"`)) {
                            foundListElement.removeChild(listItems[i]);
                            break;
                        }
                    }
                }
            };
            
            // 鼠标移动事件
            gameContainer.addEventListener('mousemove', function(e) {
                const rect = gameContainer.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                // 显示放大镜
                magnifyingGlass.style.display = 'block';
                magnifyingGlass.style.left = `${mouseX - 40}px`;
                magnifyingGlass.style.top = `${mouseY - 40}px`;
                
                // 设置放大镜内容的背景位置
                const bgRect = gameBackground.getBoundingClientRect();
                const bgX = -(mouseX - bgRect.left) * 3 + 40;
                const bgY = -(mouseY - bgRect.top) * 3 + 40;
                
                magnifyingGlassContent.style.backgroundPosition = `${bgX}px ${bgY}px`;
                magnifyingGlassContent.style.backgroundImage = `url('${currentBackground}')`;
                
                // 检查鼠标是否靠近碎片
                fragmentElements.forEach(function(fragmentElement, index) {
                    if (!foundFragments.includes(index) && !fragmentElement.classList.contains('found')) {
                        const fragmentX = parseInt(fragmentElement.style.left);
                        const fragmentY = parseInt(fragmentElement.style.top);
                        
                        // 计算鼠标与碎片的距离
                        const distance = Math.sqrt(
                            Math.pow(mouseX - fragmentX, 2) + 
                            Math.pow(mouseY - fragmentY, 2)
                        );
                        
                        // 如果距离小于100像素，显示碎片
                        if (distance < 100) {
                            fragmentElement.classList.add('nearby');
                        } else {
                            fragmentElement.classList.remove('nearby');
                        }
                    }
                });
            });
            
            // 鼠标离开游戏区域
            gameContainer.addEventListener('mouseleave', function() {
                magnifyingGlass.style.display = 'none';
                
                // 隐藏所有碎片
                fragmentElements.forEach(function(fragmentElement) {
                    fragmentElement.classList.remove('nearby');
                });
            });
            
            // 触摸事件支持（移动端）
            let lastTouchX = 0;
            let lastTouchY = 0;
            
            gameContainer.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = gameContainer.getBoundingClientRect();
                const touchX = touch.clientX - rect.left;
                const touchY = touch.clientY - rect.top;
                
                // 限制触摸移动频率，提高性能
                if (Math.abs(touchX - lastTouchX) < 5 && Math.abs(touchY - lastTouchY) < 5) {
                    return;
                }
                
                lastTouchX = touchX;
                lastTouchY = touchY;
                
                // 显示放大镜
                magnifyingGlass.style.display = 'block';
                magnifyingGlass.style.left = `${touchX - 40}px`;
                magnifyingGlass.style.top = `${touchY - 40}px`;
                
                // 设置放大镜内容的背景位置
                const bgRect = gameBackground.getBoundingClientRect();
                const bgX = -(touchX - bgRect.left) * 3 + 40;
                const bgY = -(touchY - bgRect.top) * 3 + 40;
                
                magnifyingGlassContent.style.backgroundPosition = `${bgX}px ${bgY}px`;
                magnifyingGlassContent.style.backgroundImage = `url('${currentBackground}')`;
                
                // 检查触摸点是否靠近碎片
                fragmentElements.forEach(function(fragmentElement, index) {
                    if (!foundFragments.includes(index) && !fragmentElement.classList.contains('found')) {
                        const fragmentX = parseInt(fragmentElement.style.left);
                        const fragmentY = parseInt(fragmentElement.style.top);
                        
                        // 计算触摸点与碎片的距离
                        const distance = Math.sqrt(
                            Math.pow(touchX - fragmentX, 2) + 
                            Math.pow(touchY - fragmentY, 2)
                        );
                        
                        // 如果距离小于100像素，显示碎片
                        if (distance < 100) {
                            fragmentElement.classList.add('nearby');
                        } else {
                            fragmentElement.classList.remove('nearby');
                        }
                    }
                });
            }, { passive: false });
            
            gameContainer.addEventListener('touchend', function() {
                magnifyingGlass.style.display = 'none';
                
                // 隐藏所有碎片
                fragmentElements.forEach(function(fragmentElement) {
                    fragmentElement.classList.remove('nearby');
                });
            });
            
            // 更换背景图片
            window.changeBackground = function() {
                const url = imageInput.value.trim();
                if (url) {
                    // 验证URL格式
                    try {
                        new URL(url);
                        currentBackground = url;
                        gameBackground.style.backgroundImage = `url('${url}')`;
                        // 重置放大镜内容
                        magnifyingGlassContent.style.backgroundImage = `url('${url}')`;
                    } catch (e) {
                        alert('请输入有效的图片URL');
                    }
                }
            };
            
            // 点击输入框时选中内容
            if (imageInput) {
                imageInput.addEventListener('focus', function() {
                    this.select();
                });
            }
        });
    </script>
</body>
</html>