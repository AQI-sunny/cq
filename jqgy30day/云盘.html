<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全云盘 - 密码保护的文件分享</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2d8cf0;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 28px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #fff;
            color: #2d8cf0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .main-content {
            display: flex;
            margin-top: 20px;
        }
        
        .sidebar {
            width: 200px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
            margin-right: 20px;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .sidebar-menu li:hover {
            background-color: #f0f7ff;
        }
        
        .sidebar-menu li.active {
            background-color: #e6f7ff;
            color: #2d8cf0;
            border-left: 3px solid #2d8cf0;
        }
        
        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .content {
            flex: 1;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .content-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .file-item {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .file-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .file-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #2d8cf0;
        }
        
        .file-name {
            font-size: 14px;
            margin-bottom: 5px;
            word-break: break-all;
        }
        
        .file-size {
            font-size: 12px;
            color: #999;
        }
        
        .password-modal, .extraction-access-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .password-box, .extraction-access-box {
            background-color: white;
            border-radius: 5px;
            padding: 30px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .password-title, .extraction-access-title {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .password-input, .extraction-access-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .password-buttons, .extraction-access-buttons {
            display: flex;
            justify-content: space-between;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #2d8cf0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e7ae6;
        }
        
        .btn-default {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .btn-default:hover {
            background-color: #e8e8e8;
        }
        
        .file-preview {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .preview-content {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
        }
        
        .preview-icon {
            font-size: 80px;
            color: #2d8cf0;
            margin-bottom: 20px;
        }
        
        .preview-text {
            font-size: 16px;
            color: #666;
            text-align: center;
        }
        
        .preview-text .btn {
            margin-top: 15px;
        }
        
        .online-preview {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            padding: 15px;
            overflow: auto;
        }
        
        .online-preview img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .online-preview iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .error-message, .success-message {
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
        
        .error-message {
            color: #ff4d4f;
        }
        
        .success-message {
            color: #52c41a;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: #999;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .file-item-container {
            position: relative;
        }
        
        .file-corrupted {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border-radius: 5px;
        }
        
        .corrupted-text {
            color: #ff4d4f;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .folder-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .folder-item {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }
        
        .folder-item img {
            max-width: 100%;
            height: auto;
            border-radius: 3px;
            margin-bottom: 10px;
        }
        
        .folder-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .file-list {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .online-preview {
                height: 300px;
            }
            
            .folder-preview {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
    <link rel="icon" type="image/jpeg" href="云盘logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-cloud"></i>
                <span>安全云盘</span>
            </div>
            <div class="user-info">
                <div class="user-avatar">用户</div>
                <span>我的空间</span>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li class="active" data-folder="my-files"><i class="fas fa-home"></i> 我的文件</li>
                    <li data-folder="shared"><i class="fas fa-share-alt"></i> 与我分享</li>
                    <li data-folder="recent"><i class="fas fa-history"></i> 最近使用</li>
                    <li data-folder="favorites"><i class="fas fa-star"></i> 收藏夹</li>
                    <li data-folder="trash"><i class="fas fa-trash-alt"></i> 回收站</li>
                </ul>
            </div>
            
            <div class="content">
                <div class="content-header">
                    <div class="content-title" id="folderTitle">我的文件</div>
                    <div>
                        <button class="btn btn-primary" id="accessHiddenBtn"><i class="fas fa-key"></i> 提取文件</button>
                    </div>
                </div>
                
                <div class="file-list" id="fileList">
                    <!-- 文件列表将通过JavaScript动态生成 -->
                </div>
                
                <div class="file-preview" id="filePreview">
                    <div class="preview-header">
                        <div class="content-title" id="previewFileName">文件预览</div>
                        <button class="btn btn-default" id="closePreview"><i class="fas fa-times"></i> 关闭</button>
                    </div>
                    <div class="preview-content" id="previewContent">
                        <!-- 预览内容将在这里显示 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="password-modal" id="passwordModal">
        <div class="password-box">
            <div class="password-title">请输入文件密码</div>
            <input type="password" class="password-input" id="passwordInput" placeholder="请输入文件访问密码">
            <div class="error-message" id="passwordError"></div>
            <div class="password-buttons">
                <button class="btn btn-default" id="cancelPassword">取消</button>
                <button class="btn btn-primary" id="confirmPassword">确认</button>
            </div>
        </div>
    </div>
    
    <div class="extraction-access-modal" id="extractionAccessModal">
        <div class="extraction-access-box">
            <div class="extraction-access-title">提取隐藏文件</div>
            <input type="text" class="extraction-access-input" id="extractionAccessInput" placeholder="请输入文件提取码">
            <div class="error-message" id="extractionAccessError"></div>
            <div class="extraction-access-buttons">
                <button class="btn btn-default" id="cancelExtractionAccess">取消</button>
                <button class="btn btn-primary" id="confirmExtractionAccess">提取文件</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 普通文件数据（所有人都能看到）
            const fileData = {
                'my-files': [
                    { name: '项目需求文档.pdf', size: '2.5 MB', type: 'pdf', password: '123', extractionCode: '', corrupted: true },
                    { name: '产品介绍.pptx', size: '5.7 MB', type: 'powerpoint', password: '123', extractionCode: '', corrupted: true },
                    { name: '财务数据.xlsx', size: '1.2 MB', type: 'excel', password: '123', extractionCode: '', corrupted: true },
                    { name: '设计稿.jpg', size: '3.8 MB', type: 'image', password: '123', extractionCode: '', corrupted: true },
                    { name: '演示视频.mp4', size: '45.2 MB', type: 'video', password: '123', extractionCode: '', corrupted: true },
                    { name: '会议记录.docx', size: '0.8 MB', type: 'word', password: '123', extractionCode: '', corrupted: true }
                ],
                'shared': [
                    { name: '共享文档.docx', size: '0.5 MB', type: 'word', password: '', extractionCode: '', corrupted: true }
                ],
                'recent': [
                    { name: '项目需求文档.pdf', size: '2.5 MB', type: 'pdf', password: '123', extractionCode: '', corrupted: true }
                ],
                'favorites': [
                    { name: '设计稿.jpg', size: '3.8 MB', type: 'image', password: '123', extractionCode: '', corrupted: true }
                ],
                'trash': [
                    { name: '旧版本.docx', size: '0.9 MB', type: 'word', password: '', extractionCode: '', corrupted: true }
                ]
            };

            // 隐藏文件数据（通过提取码访问）
            const hiddenFiles = {
                '7545655': {
                    name: '歌词收藏.zip',
                    size: '15.2 MB',
                    type: 'archive',
                    isSpecial: true,
                    previewType: 'folder',
                    folders: [
                        {
                            name: '文件夹1',
                            images: [
                                './11.png',
                                './17.jpg',
                                '13.jpg',
                                '16.png',
                                '歌词6.jpg'
                            ]
                        },
                         {
                            name: '文件夹2',
                            images: [
                                './歌词2.png',
                                './歌词7.jpg',
                                './歌词3.png',
                                '歌词5.png',
                                
                                '12.jpg'
                            ]
                        },
                        {
                            name: '文件夹3',
                            images: [
                                '15.jpg',
                                '9.png',
                                '8.png',
                                '歌词1.png',
                                '10.png'
                            ]
                        }
                    ]
                },
                '461461': {
                    name: '给囡囡的信.txt',
                    size: '1.2 MB',
                    type: 'text',
                    isSpecial: true,
                    previewType: 'text',
                    content: `给我最爱的囡囡：

<br>囡囡，今天是你十五岁生日。奶奶坐在老藤椅里，秋阳正暖，忽然想写封信给八年后的你——那时你该二十三岁了。时间这东西，对老人是越走越慢，对孩子是越跑越快。

<br>还记得你七岁那年的台风天吗？窗子哗哗响，你抱着小枕头钻进我被窝，说：“奶奶，<strong>娜娜（那年你给台风起的昵称，你还记得吗？）会不会把月亮吹走？</strong>”我搂着你讲台风命名的故事，你听着听着就睡了，睫毛上还挂着泪珠。现在想来，那些让你害怕的呼啸声里，藏着我最安宁的夜晚。

<br>你总说最爱吃我做的芝士绿豆糕。其实每次揉面团时，我都在想：将来囡囡去了很远的地方，会不会在某个陌生厨房里，忽然想起这个味道？然后学着我的样子，笨拙地压馅、过筛，在弥漫的香气里，与童年的自己重逢。食物是最好写的信，吃一口，什么话都收到了。

<br>囡囡，我偷偷告诉你三个秘密：

<br>第一，<strong>钢琴凳底下的盒子里</strong>，藏着你换牙期掉的第一颗乳牙。

<br>第二，我总在天气预报里夹私心——如果我说“明天适合散步”，<strong>其实是“奶奶想囡囡了”。</strong>

<br>第三，<strong>真正的宝贝不在保险柜里</strong>，而在你此刻正经过的寻常风景中。要像小时候找四叶草那样，为无用的美好低头。

<br>囡囡，人生就像台风季。有时晴空万里忽然暴雨倾盆，有时预告八级风却只吹皱池塘。但无论什么天气——你要做自己的气象站。 观测云的方向，记录心的温度，在生活的气压图上，画出独属于你的等高线。

<br>如果哪天你找不到方向了，<strong>就回老房子看看</strong>。厨房窗台那盆茉莉会一直在，<strong>你五岁时埋的弹珠还在砖缝里发亮。</strong>时间在这里走得很慢，慢到足够等你回家。

<br>最后那句“生日快乐”，我要提前八年说。
<br>因为从你出生那刻起，<strong>我的每一天都因此快乐。</strong>

<br>永远爱你的奶奶
<br>于你十五岁生日当晚


                   `
                },
            
                '1212211111': {
                    name: '《野火符箓卷》电子版.txt',
                    size: '1.2 MB',
                    type: 'text',
                    isSpecial: true,
                    previewType: 'text',
                    content: `
                       <h2>《野火符箓卷》电子版</h2>
<p><strong>【卷首戒律】</strong></p>
<p>习得符箓，不过窥天命之一隅，万不可自持。天命流之深，非凡人可测；洛河之秘，非符咒可解。吾辈辅星之能，止于观象，不可干预其核。此卷，为避祸而存。</p>

<p><strong>篇一：符咒之力的界限</strong></p>
<p><strong>第一限：凡人之光</strong></p>
<p>凡人符咒者，其力源于对天地灵气之微薄引动，其符箓能量轻浅，如荒野夜间之萤火。此萤火易熄，却也难以被天命流之探者追踪。此乃吾辈自保之基。</p>

<p><strong>第二限：序列之忌</strong></p>
<p>一旦符咒之力强行拔高，妄图观测其流、强行调律，或引动血脉之本源、耗损寿元、掺入强烈执念，其符咒光芒便会骤然增强，从萤火变成夜空火炬。炬火燃，则数字之业立显，天命流之探者必循此痕而至。凡人施法，当求"静、柔、微"，切记不可图大、图显。</p>

<p><strong>篇二：赤轮覆晷与辅星之忌</strong></p>
<p><strong>第一厄：天命流之失序</strong></p>
<p>赤轮覆晷之期，洛河狂潮化为无序之状，此时天光之盾尽失柔性。此不仅是凡人之大厄，更是<strong>辅星后裔</strong>血脉力量最弱、风险最高之时。此时，其自身的任何占测序列，皆会激发血脉之警兆，反噬自身。</p>

<p><strong>第二厄：符咒者之困局</strong></p>
<p>符咒者虽略通法术，但已沾染观测之痕。于赤轮之下，你所能施展之任何防护或辅助符咒，皆是无效之干扰。非但不能平息狂潮，反以自身数字之业，被万象之警锁定为扰动源。晦极禁法，宁可静默，不可妄施。</p>

<p><strong>篇三：定锚之术与凡人契</strong></p>
<p><strong>第一契：守秘之责</strong></p>
<p>洛河狂潮之最终定锚或调律，乃上古之盟世代所持之责，非辅星力所能及。吾等所能，不过预警、布下观测阵、或制作辅助之序列符箓。</p>

<p><strong>第二契：血脉与纯粹</strong></p>
<p>终极之锚，本须由<strong>月氏后裔</strong>以其血脉为天数之钥，启古老之阵。然血脉已污，钥不能触狂潮。故，须觅一位"不沾血脉、不具序列、不含数字之业"之凡人。</p>

<p><strong>第三契：局外者之角色</strong></p>
<p>此无信之素，乃洛书狂潮下唯一之变数。彼将代月氏后裔，完成对天命流之大契。符咒者唯一能为，乃护此凡人，安抵定锚之核心。尔乃引路者，而彼，方是执此大契、承万难之空灵凡人。</p>`
                }
            };


            // 已提取的文件存储
            let extractedFiles = JSON.parse(localStorage.getItem('extractedFiles') || '{}');
            
            // DOM元素
            const fileList = document.getElementById('fileList');
            const passwordModal = document.getElementById('passwordModal');
            const passwordInput = document.getElementById('passwordInput');
            const passwordError = document.getElementById('passwordError');
            const cancelPasswordBtn = document.getElementById('cancelPassword');
            const confirmPasswordBtn = document.getElementById('confirmPassword');
            const filePreview = document.getElementById('filePreview');
            const previewContent = document.getElementById('previewContent');
            const previewFileName = document.getElementById('previewFileName');
            const closePreviewBtn = document.getElementById('closePreview');
            const sidebarItems = document.querySelectorAll('.sidebar-menu li');
            const folderTitle = document.getElementById('folderTitle');
            const accessHiddenBtn = document.getElementById('accessHiddenBtn');
            const extractionAccessModal = document.getElementById('extractionAccessModal');
            const extractionAccessInput = document.getElementById('extractionAccessInput');
            const cancelExtractionAccessBtn = document.getElementById('cancelExtractionAccess');
            const confirmExtractionAccessBtn = document.getElementById('confirmExtractionAccess');
            const extractionAccessError = document.getElementById('extractionAccessError');
            
            let currentFile = null;
            let currentPassword = null;
            let currentFolder = 'my-files';
            
            // 初始化文件列表
            renderFileList(currentFolder);
            
            // 侧边栏菜单点击事件
            sidebarItems.forEach(item => {
                item.addEventListener('click', function() {
                    // 更新活动菜单项
                    sidebarItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新文件列表
                    currentFolder = this.getAttribute('data-folder');
                    folderTitle.textContent = this.textContent.trim();
                    renderFileList(currentFolder);
                });
            });
            
            // 提取文件按钮点击事件
            accessHiddenBtn.addEventListener('click', function() {
                extractionAccessModal.style.display = 'flex';
                extractionAccessInput.value = '';
                extractionAccessError.textContent = '';
            });
            
            // 取消密码输入
            cancelPasswordBtn.addEventListener('click', function() {
                passwordModal.style.display = 'none';
                currentFile = null;
                currentPassword = null;
            });
            
            // 确认密码
            confirmPasswordBtn.addEventListener('click', function() {
                const enteredPassword = passwordInput.value;
                
                if (enteredPassword === currentPassword) {
                    // 密码正确，显示文件预览
                    passwordModal.style.display = 'none';
                    showFilePreview(currentFile);
                } else {
                    // 密码错误
                    passwordError.textContent = '密码错误，请重新输入';
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            });
            
            // 取消提取文件
            cancelExtractionAccessBtn.addEventListener('click', function() {
                extractionAccessModal.style.display = 'none';
            });
            
            // 确认提取文件
            confirmExtractionAccessBtn.addEventListener('click', function() {
                const enteredCode = extractionAccessInput.value;
                
                if (hiddenFiles[enteredCode]) {
                    // 提取码正确，添加文件到已提取列表
                    extractedFiles[enteredCode] = hiddenFiles[enteredCode];
                    localStorage.setItem('extractedFiles', JSON.stringify(extractedFiles));
                    
                    extractionAccessModal.style.display = 'none';
                    renderFileList(currentFolder);
                    extractionAccessError.textContent = '';
                } else {
                    // 提取码错误
                    extractionAccessError.textContent = '提取码错误，请重新输入';
                    extractionAccessInput.value = '';
                    extractionAccessInput.focus();
                }
            });
            
            // 关闭预览
            closePreviewBtn.addEventListener('click', function() {
                filePreview.style.display = 'none';
            });
            
            // 渲染文件列表
            function renderFileList(folder) {
                fileList.innerHTML = '';
                
                let filesToShow = [...fileData[folder]];
                
                // 添加已提取的隐藏文件
                Object.values(extractedFiles).forEach(file => {
                    filesToShow.push(file);
                });
                
                if (filesToShow.length > 0) {
                    filesToShow.forEach(file => {
                        const fileItemContainer = document.createElement('div');
                        fileItemContainer.className = 'file-item-container';
                        
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        
                        // 文件图标
                        const fileIcon = document.createElement('div');
                        fileIcon.className = 'file-icon';
                        
                        let iconClass = 'fas fa-file';
                        switch(file.type) {
                            case 'pdf': iconClass = 'fas fa-file-pdf'; break;
                            case 'word': iconClass = 'fas fa-file-word'; break;
                            case 'excel': iconClass = 'fas fa-file-excel'; break;
                            case 'powerpoint': iconClass = 'fas fa-file-powerpoint'; break;
                            case 'image': iconClass = 'fas fa-file-image'; break;
                            case 'video': iconClass = 'fas fa-file-video'; break;
                            case 'text': iconClass = 'fas fa-file-alt'; break;
                            case 'archive': iconClass = 'fas fa-file-archive'; break;
                        }
                        
                        fileIcon.innerHTML = `<i class="${iconClass}"></i>`;
                        
                        // 文件名称
                        const fileName = document.createElement('div');
                        fileName.className = 'file-name';
                        fileName.textContent = file.name;
                        
                        // 文件大小
                        const fileSize = document.createElement('div');
                        fileSize.className = 'file-size';
                        fileSize.textContent = file.size;
                        
                        fileItem.appendChild(fileIcon);
                        fileItem.appendChild(fileName);
                        fileItem.appendChild(fileSize);
                        
                        // 如果文件已损坏，添加损坏标记
                        if (file.corrupted) {
                            const corruptedOverlay = document.createElement('div');
                            corruptedOverlay.className = 'file-corrupted';
                            corruptedOverlay.innerHTML = `
                                <i class="fas fa-exclamation-triangle" style="color: #ff4d4f; font-size: 30px;"></i>
                                <div class="corrupted-text">文件已损坏</div>
                            `;
                            fileItem.appendChild(corruptedOverlay);
                        }
                        
                        fileItemContainer.appendChild(fileItem);
                        fileList.appendChild(fileItemContainer);
                        
                        // 文件点击事件
                        fileItem.addEventListener('click', function() {
                            if (file.corrupted) {
                                alert('文件已损坏，无法打开');
                                return;
                            }
                            
                            currentFile = file;
                            currentPassword = file.password;
                            
                            // 在回收站、收藏夹和与我分享中无需密码
                            // 特殊文件也无需密码
                            if (folder === 'trash' || folder === 'favorites' || folder === 'shared' || file.isSpecial) {
                                showFilePreview(file);
                            } else if (file.password) {
                                // 显示密码输入框
                                passwordModal.style.display = 'flex';
                                passwordInput.value = '';
                                passwordError.textContent = '';
                            } else {
                                // 无密码文件直接预览
                                showFilePreview(file);
                            }
                        });
                    });
                } else {
                    fileList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <div>此文件夹为空</div>
                        </div>
                    `;
                }
            }
            
            // 显示文件预览
            function showFilePreview(file) {
                previewFileName.textContent = file.name;
                
                let previewHTML = '';
                
                if (file.isSpecial) {
                    // 特殊文件在线预览
                    if (file.previewType === 'text') {
                        previewHTML = `
                            <div class="online-preview">
                                ${file.content}
                            </div>
                            <div style="margin-top: 15px;">
                                <button class="btn btn-primary download-btn">
                                    <i class="fas fa-download"></i> 下载文件
                                </button>
                            </div>
                        `;
                    } else if (file.previewType === 'folder') {
                        previewHTML = `
                            <div class="online-preview">
                                <h3>压缩包内容预览</h3>
                                <div class="folder-preview">
                        `;
                        
                        file.folders.forEach(folder => {
                            previewHTML += `
                                <div class="folder-item">
                                    <div class="folder-name">${folder.name}</div>
                            `;
                            
                            folder.images.forEach(image => {
                                previewHTML += `
                                    <img src="${image}" alt="${folder.name}中的图片" style="max-width: 100%; margin-bottom: 10px;">
                                `;
                            });
                            
                            previewHTML += `</div>`;
                        });
                        
                        previewHTML += `
                                </div>
                            </div>
                            <div style="margin-top: 15px;">
                                <button class="btn btn-primary download-btn">
                                    <i class="fas fa-download"></i> 下载文件
                                </button>
                            </div>
                        `;
                    }
                } else {
                    // 普通文件预览
                    switch(file.type) {
                        case 'pdf':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="preview-text">
                                    PDF文件预览功能需要专业PDF阅读器支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'word':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-word"></i>
                                </div>
                                <div class="preview-text">
                                    Word文档预览功能需要专业文档阅读器支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'excel':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <div class="preview-text">
                                    Excel表格预览功能需要专业表格阅读器支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'powerpoint':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-powerpoint"></i>
                                </div>
                                <div class="preview-text">
                                    PowerPoint演示文稿预览功能需要专业演示软件支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'image':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-image"></i>
                                </div>
                                <div class="preview-text">
                                    图片预览功能需要专业图片查看器支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'video':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-video"></i>
                                </div>
                                <div class="preview-text">
                                    视频预览功能需要专业视频播放器支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'text':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="preview-text">
                                    文本文件预览功能需要专业文本阅读器支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        case 'archive':
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file-archive"></i>
                                </div>
                                <div class="preview-text">
                                    压缩文件预览功能需要专业压缩软件支持<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                            break;
                        default:
                            previewHTML = `
                                <div class="preview-icon">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="preview-text">
                                    此文件类型不支持在线预览<br>
                                    <button class="btn btn-primary download-btn">
                                        <i class="fas fa-download"></i> 下载文件
                                    </button>
                                </div>
                            `;
                    }
                }
                
                previewContent.innerHTML = previewHTML;
                
                // 添加下载按钮事件
                const downloadBtn = previewContent.querySelector('.download-btn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', function() {
                        alert(`开始下载文件: ${file.name}`);
                        // 在实际应用中，这里应该触发文件下载
                    });
                }
                
                filePreview.style.display = 'block';
            }
            
            // 点击模态框外部关闭
            window.addEventListener('click', function(event) {
                if (event.target === passwordModal) {
                    passwordModal.style.display = 'none';
                    currentFile = null;
                    currentPassword = null;
                }
                
                if (event.target === extractionAccessModal) {
                    extractionAccessModal.style.display = 'none';
                }
            });
        });
    </script>

<script>
// 回车键快捷提取功能
document.addEventListener('DOMContentLoaded', function() {
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            const activeElement = document.activeElement;
            const isInputFocused = activeElement.tagName === 'INPUT' || 
                                  activeElement.tagName === 'TEXTAREA' ||
                                  activeElement.isContentEditable;
            
            if (!isInputFocused) {
                e.preventDefault();
                const accessHiddenBtn = document.getElementById('accessHiddenBtn');
                if (accessHiddenBtn) {
                    accessHiddenBtn.click();
                }
            }
        }
    });
});
</script>

<script src="return.js"></script>
</body>

</html>
