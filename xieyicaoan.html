<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>股权协议草案</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 0;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* 顶部工具栏 */
        .toolbar {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .toolbar-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toolbar-title i {
            font-size: 1.4rem;
        }
        
        .toolbar-actions {
            display: flex;
            gap: 15px;
        }
        
        .toolbar-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        
        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        /* PDF查看器样式 */
        .pdf-viewer {
            flex: 1;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }
        
        .document-container {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        
        /* 文档头部 - 类似PDF */
        .document-header {
            background-color: #f5f7fa;
            padding: 25px 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .document-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .document-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .document-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }
        
        .meta-item {
            display: flex;
            flex-direction: column;
        }
        
        .meta-label {
            font-size: 0.85rem;
            color: #777;
            margin-bottom: 3px;
        }
        
        .meta-value {
            font-weight: 600;
            color: #333;
        }
        
        /* 文档内容 */
        .document-content {
            padding: 30px;
        }
        
        .document-section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a237e;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8eaf6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #3949ab;
        }
        
        .section-content {
            font-size: 1rem;
            line-height: 1.8;
            color: #444;
        }
        
        .section-content p {
            margin-bottom: 15px;
        }
        
        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .data-table th {
            background-color: #e8eaf6;
            color: #1a237e;
            font-weight: 600;
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .data-table td {
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* 重点标注 */
        .highlight-box {
            background-color: #fff8e1;
            border-left: 5px solid #ffb300;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .highlight-title {
            font-weight: 700;
            color: #ff6f00;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* 审阅标记 */
        .review-note {
            background-color: #e3f2fd;
            border-left: 5px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }
        
        .review-note-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1565c0;
        }
        
        /* 签名区域 */
        .signature-area {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
        }
        
        .signature-line {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .signature-box {
            flex: 1;
            min-width: 200px;
        }
        
        .signature-label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .signature-placeholder {
            height: 60px;
            border-bottom: 2px solid #999;
            margin-bottom: 10px;
        }
        
        /* 底部操作栏 */
        .action-bar {
            background-color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
            position: sticky;
            bottom: 0;
            z-index: 100;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 140px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #1a237e, #3949ab);
            color: white;
        }
        
        .btn-secondary {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-warning {
            background: linear-gradient(to right, #ff9800, #f57c00);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, #3949ab, #303f9f);
        }
        
        .btn-warning:hover {
            background: linear-gradient(to right, #f57c00, #ef6c00);
        }
        
        .page-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 0.95rem;
        }
        
        /* 自制弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            padding: 20px;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(30px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.3rem;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 25px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            border-top: 1px solid #eee;
        }
        
        .modal-footer .action-btn {
            min-width: 100px;
            padding: 10px 20px;
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            .toolbar {
                padding: 12px 15px;
            }
            
            .pdf-viewer {
                padding: 15px;
            }
            
            .document-header {
                padding: 20px;
            }
            
            .document-title {
                font-size: 1.5rem;
            }
            
            .document-content {
                padding: 20px;
            }
            
            .action-bar {
                padding: 12px 15px;
            }
            
            .action-btn {
                padding: 10px 15px;
                min-width: 120px;
                font-size: 0.95rem;
            }
            
            .data-table {
                font-size: 0.85rem;
            }
            
            .data-table th, 
            .data-table td {
                padding: 8px 10px;
            }
        }
        
        @media (max-width: 480px) {
            .toolbar-title span:not(:first-child) {
                display: none;
            }
            
            .document-header {
                padding: 15px;
            }
            
            .document-title {
                font-size: 1.3rem;
            }
            
            .document-meta {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-btn {
                width: 100%;
            }
            
            .signature-line {
                flex-direction: column;
            }
        }
        
        /* 兼容TapTap H5环境 */
        @media (max-height: 600px) {
            .pdf-viewer {
                padding: 10px;
            }
            
            .action-bar {
                padding: 10px 15px;
            }
        }
        
        /* 禁用文字选择（提高移动端体验） */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 滚动条样式优化 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* 页面加载动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .document-container {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 顶部工具栏 -->
        <div class="toolbar">
            <div class="toolbar-title">
                <i class="fas fa-file-contract"></i>
                <span>股权协议草案</span>
            </div>
            <div class="toolbar-actions">
                <button class="toolbar-btn" id="btnPrint" title="打印">
                    <i class="fas fa-print"></i>
                </button>
                <button class="toolbar-btn" id="btnBookmark" title="添加书签">
                    <i class="far fa-bookmark"></i>
                </button>
                <button class="toolbar-btn" id="btnShare" title="分享">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- PDF查看器主体 -->
        <div class="pdf-viewer">
            <div class="document-container">
                <!-- 文档头部 -->
                <div class="document-header">
                    <h1 class="document-title">股权转让协议草案</h1>
                    <p class="document-subtitle"><strong>草案编号：GQ-ZY-2025-0087</strong></p>
                  <!--   <p class="document-subtitle">审阅版本：第三方审阅版 V1.2</p> -->
                    
                    <div class="document-meta">
                        <div class="meta-item">
                            <span class="meta-label">转让方</span>
                            <span class="meta-value">李健兴</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">受让方</span>
                            <span class="meta-value">[待确认]</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">草案日期</span>
                            <span class="meta-value">2025年12月15日</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">审阅律师</span>
                            <span class="meta-value">张正平 律师</span>
                        </div>
                    </div>
                </div>
                
                <!-- 文档内容 -->
                <div class="document-content">
                    <!-- 第一部分 -->
                    <div class="document-section">
                        <div class="section-title">
                            <i class="fas fa-balance-scale"></i>
                            第一条 协议背景与目的
                        </div>
                        <div class="section-content">
                            <p>本协议由转让方李健兴（下称"甲方"）与受让方（下称"乙方"）共同订立，旨在明确甲方将其持有的"兴健科技集团"（下称"目标公司"）15%股权转让给乙方的相关事宜。</p>
                            
                            <div class="review-note">
                                <div class="review-note-header">
                                    <span>审阅意见 #1</span>
                                    <span>张正平 律师</span>
                                </div>
                                <p>建议明确受让方主体信息。根据《公司法》规定，股权转让协议需明确双方主体身份，避免后续法律纠纷。</p>
                            </div>
                            
                            <div class="highlight-box">
                                <div class="highlight-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    第三方关注点
                                </div>
                                <p>本协议为低价转让协议，转让价格显著低于市场公允价值，可能存在税务风险及债权人异议风险。建议转让方提供合理解释并准备相关证明文件。</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第二部分 -->
                    <div class="document-section">
                        <div class="section-title">
                            <i class="fas fa-chart-line"></i>
                            第二条 转让标的与价格
                        </div>
                        <div class="section-content">
                            <p>甲方同意将其持有的目标公司15%股权（对应注册资本150万元人民币）转让给乙方。</p>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>项目</th>
                                        <th>内容</th>
                                        <th>备注</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>转让股权比例</td>
                                        <td>15%</td>
                                        <td>目标公司总股本1000万元</td>
                                    </tr>
                                    <tr>
                                        <td>转让价格</td>
                                        <td>人民币850,000元</td>
                                        <td class="warning">低价转让</td>
                                    </tr>
                                    <tr>
                                        <td>市场公允价值</td>
                                        <td>人民币1,200,000-1,500,000元</td>
                                        <td>根据最近评估报告</td>
                                    </tr>
                                    <tr>
                                        <td>价格差异率</td>
                                        <td>约30%-45%</td>
                                        <td>显著低于市场价</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="review-note">
                                <div class="review-note-header">
                                    <span>审阅意见 #2</span>
                                    <span>张正平 律师</span>
                                </div>
                                <p>根据《股权转让所得个人所得税管理办法（试行）》，股权转让收入明显偏低且无正当理由的，税务机关有权核定转让收入。建议补充低价转让的正当理由说明，以避免税务风险。</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第三部分 -->
                    <div class="document-section">
                        <div class="section-title">
                            <i class="fas fa-handshake"></i>
                            第三条 支付方式与期限
                        </div>
                        <div class="section-content">
                            <p>1. 本协议签署后5个工作日内，乙方向甲方支付转让价款的60%，即人民币510,000元。</p>
                            <p>2. 股权工商变更登记完成后10个工作日内，乙方向甲方支付剩余40%转让价款，即人民币340,000元。</p>
                            <p>3. 所有款项应通过银行转账方式支付至甲方指定账户。</p>
                            
                            <div class="highlight-box">
                                <div class="highlight-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    第三方关注点
                                </div>
                                <p>支付条款对转让方较为有利。受让方需注意，在支付大部分款项后若工商变更遇到障碍，可能面临款项追回困难。建议考虑设立共管账户或引入第三方担保。</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第四部分 -->
                    <div class="document-section">
                        <div class="section-title">
                            <i class="fas fa-clipboard-check"></i>
                            第四条 陈述与保证
                        </div>
                        <div class="section-content">
                            <p>1. 甲方保证其对转让股权拥有完全、合法的处分权，不存在任何质押、查封或其他权利限制。</p>
                            <p>2. 甲方保证目标公司不存在未披露的重大债务或诉讼。</p>
                            <p>3. 乙方保证其具有受让股权的合法资格与支付能力。</p>
                            
                            <div class="review-note">
                                <div class="review-note-header">
                                    <span>审阅意见 #3</span>
                                    <span>张正平 律师</span>
                                </div>
                                <p>建议增加违约责任条款，明确一方违反陈述保证时应承担的具体责任，包括但不限于赔偿损失、支付违约金等。</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第五部分 -->
                    <div class="document-section">
                        <div class="section-title">
                            <i class="fas fa-exclamation-circle"></i>
                            第五条 特别风险提示（第三方视角）
                        </div>
                        <div class="section-content">
                            <p>基于第三方独立审阅，本协议存在以下需特别关注的风险点：</p>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>风险类别</th>
                                        <th>风险描述</th>
                                        <th>风险等级</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>税务风险</td>
                                        <td>低价转让可能被税务机关核定调增收入，产生补税及滞纳金</td>
                                        <td class="warning">高</td>
                                    </tr>
                                    <tr>
                                        <td>债权人异议风险</td>
                                        <td>目标公司债权人可能以低价转让损害其利益为由主张撤销权</td>
                                        <td class="warning">中</td>
                                    </tr>
                                    <tr>
                                        <td>信息披露风险</td>
                                        <td>未充分披露的低价转让理由可能导致后续法律纠纷</td>
                                        <td>中</td>
                                    </tr>
                                    <tr>
                                        <td>支付风险</td>
                                        <td>受让方在工商变更前支付大部分款项存在资金安全风险</td>
                                        <td>中</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="review-note">
                                <div class="review-note-header">
                                    <span>审阅建议</span>
                                    <span>张正平 律师</span>
                                </div>
                                <p>建议双方：(1) 补充详细低价转让理由说明并准备证明材料；(2) 考虑调整支付节奏，增加共管账户安排；(3) 向税务机关提前沟通并获取书面确认；(4) 完善信息披露条款，确保不存在重大遗漏。</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 签名区域 -->
                    <div class="signature-area">
                        <div class="section-title">
                            <i class="fas fa-signature"></i>
                            签署页
                        </div>
                        <p>本协议一式四份，甲乙双方各执一份，目标公司留存一份，工商登记机关备案一份，具有同等法律效力。</p>
                        
                        <div class="signature-line">
                            <div class="signature-box">
                                <div class="signature-label">转让方（甲方）：</div>
                                <div class="signature-placeholder"></div>
                                <div>李健兴</div>
                                <div>日期：____年____月____日</div>
                            </div>
                            
                            <div class="signature-box">
                                <div class="signature-label">受让方（乙方）：</div>
                                <div class="signature-placeholder"></div>
                                <div>____________________</div>
                                <div>日期：____年____月____日</div>
                            </div>
                        </div>
                        
                        <div class="signature-box" style="margin-top: 30px;">
                            <div class="signature-label">第三方见证/审阅方：</div>
                            <div class="signature-placeholder"></div>
                            <div>张正平 律师</div>
                            <div>正平律师事务所</div>
                            <div>日期：2025年12月15日</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page-indicator">
                <i class="fas fa-file-alt"></i>
                <span>第 1 页 / 共 1 页</span>
            </div>
        </div>
        
        <!-- 底部操作栏 -->
        <div class="action-bar">
            <div class="action-buttons-left">
                <button class="action-btn btn-secondary" id="btnDownload">
                    <i class="fas fa-download"></i>
                    下载草案
                </button>
                <button class="action-btn btn-secondary" id="btnAddComment">
                    <i class="fas fa-comment-medical"></i>
                    添加批注
                </button>
            </div>
            
            <div class="action-buttons-right">
                <button class="action-btn btn-warning" id="btnRaiseIssue">
                    <i class="fas fa-flag"></i>
                    提出问题
                </button>
                <button class="action-btn btn-primary" id="btnReviewComplete">
                    <i class="fas fa-check-circle"></i>
                    完成审阅
                </button>
            </div>
        </div>
        
        <!-- 自制弹窗系统 -->
        <div class="modal-overlay" id="modalOverlay">
            <div class="modal" id="modal">
                <!-- 弹窗内容由JS动态生成 -->
            </div>
        </div>
    </div>

    <script>
        // DOM元素获取
        const modalOverlay = document.getElementById('modalOverlay');
        const modal = document.getElementById('modal');
        
        // 弹窗系统
        class CustomModal {
            constructor() {
                this.isOpen = false;
                this.currentCallbacks = {};
            }
            
            // 打开弹窗
            open(title, content, buttons = []) {
                // 构建弹窗内容
                let modalHTML = `
                    <div class="modal-header">
                        <h3>${title}</h3>
                        <button class="modal-close" id="modalCloseBtn">&times;</button>
                    </div>
                    <div class="modal-body">${content}</div>
                `;
                
                // 如果有自定义按钮
                if (buttons.length > 0) {
                    modalHTML += '<div class="modal-footer">';
                    buttons.forEach(btn => {
                        modalHTML += `<button class="action-btn ${btn.class}" id="${btn.id}">${btn.text}</button>`;
                    });
                    modalHTML += '</div>';
                } else {
                    // 默认关闭按钮
                    modalHTML += `
                        <div class="modal-footer">
                            <button class="action-btn btn-secondary" id="modalCloseBtn2">关闭</button>
                        </div>
                    `;
                }
                
                // 更新弹窗内容
                modal.innerHTML = modalHTML;
                
                // 显示弹窗
                modalOverlay.classList.add('active');
                this.isOpen = true;
                
                // 添加事件监听
                this.setupEventListeners();
                
                // 清空之前的回调
                this.currentCallbacks = {};
                
                // 存储按钮回调
                buttons.forEach(btn => {
                    if (btn.callback) {
                        this.currentCallbacks[btn.id] = btn.callback;
                    }
                });
            }
            
            // 设置事件监听
            setupEventListeners() {
                // 关闭按钮事件
                const closeBtn = document.getElementById('modalCloseBtn');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => this.close());
                }
                
                const closeBtn2 = document.getElementById('modalCloseBtn2');
                if (closeBtn2) {
                    closeBtn2.addEventListener('click', () => this.close());
                }
                
                // 点击遮罩层关闭弹窗
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        this.close();
                    }
                });
                
                // 键盘ESC键关闭弹窗
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isOpen) {
                        this.close();
                    }
                });
                
                // 自定义按钮事件
                Object.keys(this.currentCallbacks).forEach(btnId => {
                    const btn = document.getElementById(btnId);
                    if (btn) {
                        btn.addEventListener('click', () => {
                            this.currentCallbacks[btnId]();
                        });
                    }
                });
            }
            
            // 关闭弹窗
            close() {
                modalOverlay.classList.remove('active');
                this.isOpen = false;
            }
        }
        
        // 创建弹窗实例
        const customModal = new CustomModal();
        
        // 顶部工具栏按钮事件
        document.getElementById('btnPrint').addEventListener('click', () => {
            customModal.open(
                '打印文档',
                '<p>您即将打印"股权转让协议草案（第三方审阅版）"</p><p>请确保您的设备已连接打印机，或选择"另存为PDF"进行保存。</p>',
                [
                    { id: 'modalCancel', text: '取消', class: 'btn-secondary' },
                    { id: 'modalPrint', text: '继续打印', class: 'btn-primary', callback: () => {
                        customModal.close();
                        // 模拟打印操作
                        setTimeout(() => {
                            customModal.open(
                                '打印提示',
                                '<p><i class="fas fa-print" style="font-size: 2rem; color: #1a237e; margin-bottom: 15px; display: block; text-align: center;"></i></p><p>文档已发送到打印队列，请在打印机设置中查看打印状态。</p>',
                                [
                                    { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                ]
                            );
                        }, 300);
                    }}
                ]
            );
        });
        
        document.getElementById('btnBookmark').addEventListener('click', () => {
            let bookmarked = false;
            const btn = document.getElementById('btnBookmark');
            
            if (btn.querySelector('.far')) {
                btn.innerHTML = '<i class="fas fa-bookmark"></i>';
                customModal.open(
                    '添加书签',
                    '<p>已将此文档添加到书签列表。</p><p>您可以在"我的书签"中快速访问此文档。</p>',
                    [
                        { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                    ]
                );
            } else {
                btn.innerHTML = '<i class="far fa-bookmark"></i>';
                customModal.open(
                    '移除书签',
                    '<p>已将此文档从书签列表中移除。</p>',
                    [
                        { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                    ]
                );
            }
        });
        
        document.getElementById('btnShare').addEventListener('click', () => {
            customModal.open(
                '分享文档',
                `
                <p>选择分享方式：</p>
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin: 20px 0; justify-content: center;">
                    <div style="text-align: center; cursor: pointer;" id="shareWechat">
                        <div style="width: 60px; height: 60px; background: #09bb07; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                            <i class="fab fa-weixin" style="color: white; font-size: 1.8rem;"></i>
                        </div>
                        <div>微信</div>
                    </div>
                    <div style="text-align: center; cursor: pointer;" id="shareEmail">
                        <div style="width: 60px; height: 60px; background: #ea4335; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                            <i class="fas fa-envelope" style="color: white; font-size: 1.8rem;"></i>
                        </div>
                        <div>邮件</div>
                    </div>
                    <div style="text-align: center; cursor: pointer;" id="shareLink">
                        <div style="width: 60px; height: 60px; background: #1a237e; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                            <i class="fas fa-link" style="color: white; font-size: 1.8rem;"></i>
                        </div>
                        <div>复制链接</div>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #666; margin-top: 15px;">注意：分享前请确保已获得相关方授权。</p>
                `,
                [
                    { id: 'modalCancel', text: '取消', class: 'btn-secondary', callback: () => customModal.close() }
                ]
            );
            
            // 添加分享选项事件
            setTimeout(() => {
                document.getElementById('shareWechat').addEventListener('click', () => {
                    customModal.close();
                    setTimeout(() => {
                        customModal.open(
                            '微信分享',
                            '<p>已生成文档分享二维码，请使用微信扫描。</p><div style="text-align: center; margin: 20px 0;"><div style="width: 150px; height: 150px; background: #f5f5f5; margin: 0 auto; display: flex; align-items: center; justify-content: center; border-radius: 8px;"><i class="fas fa-qrcode" style="font-size: 5rem; color: #999;"></i></div></div>',
                            [
                                { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                            ]
                        );
                    }, 300);
                });
                
                document.getElementById('shareEmail').addEventListener('click', () => {
                    customModal.close();
                    setTimeout(() => {
                        customModal.open(
                            '邮件分享',
                            '<p>请输入收件人邮箱地址：</p><input type="email" id="emailInput" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin: 15px 0; font-size: 1rem;"><p><small>系统将发送包含文档链接的邮件到指定邮箱。</small></p>',
                            [
                                { id: 'modalCancel', text: '取消', class: 'btn-secondary', callback: () => customModal.close() },
                                { id: 'modalSend', text: '发送', class: 'btn-primary', callback: () => {
                                    const emailInput = document.getElementById('emailInput');
                                    if (emailInput && emailInput.value) {
                                        customModal.close();
                                        setTimeout(() => {
                                            customModal.open(
                                                '发送成功',
                                                `<p>文档链接已发送到 ${emailInput.value}</p><p>收件人将收到包含文档访问链接的电子邮件。</p>`,
                                                [
                                                    { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                                ]
                                            );
                                        }, 300);
                                    } else {
                                        emailInput.style.borderColor = '#ea4335';
                                        emailInput.focus();
                                    }
                                }}
                            ]
                        );
                    }, 300);
                });
                
                document.getElementById('shareLink').addEventListener('click', () => {
                    // 模拟复制链接操作
                    navigator.clipboard.writeText('https://legal-docs.example.com/equity-agreement/2023-0087').then(() => {
                        customModal.close();
                        setTimeout(() => {
                            customModal.open(
                                '链接已复制',
                                '<p>文档链接已复制到剪贴板。</p><p>您可以将链接发送给需要访问此文档的人员。</p><div style="background: #f5f5f5; padding: 10px; border-radius: 6px; margin: 15px 0; font-size: 0.9rem; word-break: break-all;">https://legal-docs.example.com/equity-agreement/2023-0087</div>',
                                [
                                    { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                ]
                            );
                        }, 300);
                    });
                });
            }, 100);
        });
        
        // 底部操作按钮事件
        document.getElementById('btnDownload').addEventListener('click', () => {
            customModal.open(
                '下载文档',
                '<p>选择下载格式：</p><div style="margin: 20px 0;"><label style="display: block; margin-bottom: 10px;"><input type="radio" name="format" value="pdf" checked> PDF格式（推荐）</label><label style="display: block; margin-bottom: 10px;"><input type="radio" name="format" value="word"> Word文档（可编辑）</label><label style="display: block;"><input type="radio" name="format" value="html"> HTML网页</label></div><p><small>文件大小约 1.2 MB，下载时间取决于您的网络速度。</small></p>',
                [
                    { id: 'modalCancel', text: '取消', class: 'btn-secondary', callback: () => customModal.close() },
                    { id: 'modalDownload', text: '下载', class: 'btn-primary', callback: () => {
                        customModal.close();
                        // 模拟下载操作
                        setTimeout(() => {
                            customModal.open(
                                '下载开始',
                                '<p><i class="fas fa-download" style="font-size: 2rem; color: #1a237e; margin-bottom: 15px; display: block; text-align: center;"></i></p><p>文档下载已开始，请查看浏览器的下载列表。</p><p>如果下载没有自动开始，请检查浏览器设置或稍后重试。</p>',
                                [
                                    { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                ]
                            );
                        }, 300);
                    }}
                ]
            );
        });
        
        document.getElementById('btnAddComment').addEventListener('click', () => {
            customModal.open(
                '添加批注',
                `
                <p>选择批注位置：</p>
                <select id="commentSection" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin: 10px 0 20px; font-size: 1rem;">
                    <option value="1">第一条 协议背景与目的</option>
                    <option value="2">第二条 转让标的与价格</option>
                    <option value="3">第三条 支付方式与期限</option>
                    <option value="4">第四条 陈述与保证</option>
                    <option value="5">第五条 特别风险提示</option>
                </select>
                <p>批注内容：</p>
                <textarea id="commentText" rows="5" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin: 10px 0 20px; font-size: 1rem; resize: vertical;" placeholder="请输入您的批注内容..."></textarea>
                <p><small>批注将仅对您可见，除非您选择共享给其他审阅者。</small></p>
                `,
                [
                    { id: 'modalCancel', text: '取消', class: 'btn-secondary', callback: () => customModal.close() },
                    { id: 'modalSave', text: '保存批注', class: 'btn-primary', callback: () => {
                        const commentText = document.getElementById('commentText');
                        if (commentText && commentText.value.trim()) {
                            customModal.close();
                            setTimeout(() => {
                                customModal.open(
                                    '批注已保存',
                                    '<p>您的批注已成功保存。</p><p>您可以在文档右侧的批注面板中查看和管理所有批注。</p>',
                                    [
                                        { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                    ]
                                );
                            }, 300);
                        } else {
                            commentText.style.borderColor = '#ea4335';
                            commentText.focus();
                        }
                    }}
                ]
            );
        });
        
        document.getElementById('btnRaiseIssue').addEventListener('click', () => {
            customModal.open(
                '提出问题',
                `
                <p>请描述您发现的问题：</p>
                <textarea id="issueText" rows="5" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin: 10px 0 15px; font-size: 1rem; resize: vertical;" placeholder="请详细描述协议中存在的问题或风险..."></textarea>
                <p>问题严重程度：</p>
                <div style="margin: 10px 0 20px;">
                    <label style="margin-right: 15px;"><input type="radio" name="severity" value="low"> 低</label>
                    <label style="margin-right: 15px;"><input type="radio" name="severity" value="medium" checked> 中</label>
                    <label><input type="radio" name="severity" value="high"> 高</label>
                </div>
                <p><small>问题将提交给协议起草方，并可能触发修订流程。</small></p>
                `,
                [
                    { id: 'modalCancel', text: '取消', class: 'btn-secondary', callback: () => customModal.close() },
                    { id: 'modalSubmit', text: '提交问题', class: 'btn-warning', callback: () => {
                        const issueText = document.getElementById('issueText');
                        if (issueText && issueText.value.trim()) {
                            customModal.close();
                            setTimeout(() => {
                                customModal.open(
                                    '问题已提交',
                                    '<p>您的问题已成功提交。</p><p>协议起草方将收到通知，并可能在修订版本中回应您的问题。</p><p>您可以在"问题跟踪"中查看问题状态。</p>',
                                    [
                                        { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                    ]
                                );
                            }, 300);
                        } else {
                            issueText.style.borderColor = '#ea4335';
                            issueText.focus();
                        }
                    }}
                ]
            );
        });
        
        document.getElementById('btnReviewComplete').addEventListener('click', () => {
            customModal.open(
                '完成审阅',
                `
                <p>您即将标记此协议草案审阅完成。</p>
                <div style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <p><strong>确认事项：</strong></p>
                    <p><input type="checkbox" id="confirm1" style="margin-right: 8px;">我已审阅全部协议内容</p>
                    <p><input type="checkbox" id="confirm2" style="margin-right: 8px;">我已记录所有关注问题</p>
                    <p><input type="checkbox" id="confirm3" style="margin-right: 8px;">我理解协议中的风险提示</p>
                    <p><input type="checkbox" id="confirm4" style="margin-right: 8px;">我已完成内部审批流程</p>
                </div>
                <p><small>审阅完成后，系统将生成审阅报告并通知相关方。</small></p>
                `,
                [
                    { id: 'modalCancel', text: '取消', class: 'btn-secondary', callback: () => customModal.close() },
                    { id: 'modalComplete', text: '确认完成', class: 'btn-primary', callback: () => {
                        const checkboxes = ['confirm1', 'confirm2', 'confirm3', 'confirm4'];
                        const allChecked = checkboxes.every(id => document.getElementById(id).checked);
                        
                        if (allChecked) {
                            customModal.close();
                            setTimeout(() => {
                                customModal.open(
                                    '审阅完成',
                                    '<p><i class="fas fa-check-circle" style="font-size: 3rem; color: #2e7d32; margin-bottom: 15px; display: block; text-align: center;"></i></p><p>协议审阅流程已完成！</p><p>系统已生成审阅报告并发送给相关方。您可以在"我的审阅"中查看报告详情。</p>',
                                    [
                                        { id: 'modalOK', text: '确定', class: 'btn-primary', callback: () => customModal.close() }
                                    ]
                                );
                            }, 300);
                        } else {
                            // 提示用户勾选所有确认项
                            setTimeout(() => {
                                const modalBody = document.querySelector('.modal-body');
                                if (modalBody) {
                                    const warning = document.createElement('div');
                                    warning.innerHTML = '<p style="color: #ea4335; margin-top: 10px;">请勾选所有确认事项</p>';
                                    modalBody.appendChild(warning);
                                }
                            }, 10);
                        }
                    }}
                ]
            );
        });
        
        // 页面初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 添加点击交互效果
            const reviewNotes = document.querySelectorAll('.review-note');
            reviewNotes.forEach(note => {
                note.addEventListener('click', () => {
                    note.style.transform = 'translateX(5px)';
                    note.style.boxShadow = '0 4px 12px rgba(33, 150, 243, 0.2)';
                    setTimeout(() => {
                        note.style.transform = 'translateX(0)';
                        note.style.boxShadow = 'none';
                    }, 200);
                });
            });
            
            // 兼容性提示
            if (/TapTap|TDS/.test(navigator.userAgent)) {
                console.log('检测到TapTap H5环境，已优化交互体验');
            }
            
            // 添加页面滚动效果
            let lastScrollTop = 0;
            const toolbar = document.querySelector('.toolbar');
            const actionBar = document.querySelector('.action-bar');
            
            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    // 向下滚动
                    toolbar.style.transform = 'translateY(-100%)';
                    actionBar.style.transform = 'translateY(100%)';
                } else {
                    // 向上滚动
                    toolbar.style.transform = 'translateY(0)';
                    actionBar.style.transform = 'translateY(0)';
                }
                
                lastScrollTop = scrollTop;
            });
        });
    </script>
</body>
</html>